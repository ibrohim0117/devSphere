{% load static %}
<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - devSphere</title>
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/posts_list.css' %}">
</head>
<body>
<header>
    <h1><a href="{% url 'home' %}">ğŸš€ devSphere</a></h1>
</header>
<div class="page-wrapper">
    <div class="posts-container">
        <a href="{% url 'home' %}" class="back-link">â† Bosh sahifaga qaytish</a>
        <h1>ğŸ”§ Admin Panel - Barcha Postlar</h1>

        {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                    <li class="{{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <div class="stats">
            <div class="stat-card">
                <h3>{{ total_posts }}</h3>
                <p>ğŸ“Š Jami postlar</p>
            </div>
            <div class="stat-card">
                <h3>{{ active_posts }}</h3>
                <p>âœ… Faol postlar</p>
            </div>
            <div class="stat-card">
                <h3>{{ inactive_posts }}</h3>
                <p>â³ Nofaol postlar</p>
            </div>
        </div>

        <div class="filters">
            <form method="get" class="filter-form">
                <div class="filter-group">
                    <label for="status">ğŸ“Š Holat:</label>
                    <select name="status" id="status">
                        <option value="">Barchasi</option>
                        <option value="active" {% if status_filter == 'active' %}selected{% endif %}>âœ… Faol</option>
                        <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>â³ Nofaol</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="q">ğŸ” Qidirish:</label>
                    <input type="text" name="q" id="q" value="{{ search_query }}" placeholder="Sarlavha bo'yicha...">
                </div>
                <button type="submit" class="filter-group button">ğŸ” Qidirish</button>
                <a href="{% url 'admin_posts' %}" class="filter-group action-btn btn-clear">ğŸ”„ Tozalash</a>
            </form>
        </div>

        {% if post_list %}
            <table class="posts-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Sarlavha</th>
                        <th>Muallif</th>
                        <th>Kategoriya</th>
                        <th>ğŸ‘ï¸ Ko'rishlar</th>
                        <th>ğŸ’¬ Reaktsiyalar</th>
                        <th>Holat</th>
                        <th>ğŸ“… Yaratilgan</th>
                        <th>Amallar</th>
                    </tr>
                </thead>
                <tbody>
                    {% for post in post_list %}
                        <tr>
                            <td><strong>#{{ post.id }}</strong></td>
                            <td>
                                <a href="{% url 'post' post.slug %}">
                                    {{ post.title|truncatewords:8 }}
                                </a>
                            </td>
                            <td>{{ post.author.email }}</td>
                            <td>{{ post.category.name }}</td>
                            <td>{{ post.views }}</td>
                            <td>{{ post.reactions.count }}</td>
                            <td>
                                <span class="post-status {% if post.is_active %}active{% else %}inactive{% endif %}">
                                    {% if post.is_active %}âœ… Faol{% else %}â³ Nofaol{% endif %}
                                </span>
                            </td>
                            <td>{{ post.created_at|date:"d.m.Y H:i" }}</td>
                            <td>
                                <div class="post-actions">
                                    <a href="{% url 'post' post.slug %}" class="action-btn btn-edit" title="Ko'rish">ğŸ‘ï¸</a>
                                    <a href="{% url 'toggle_post_status' post.id %}" 
                                       class="action-btn {% if post.is_active %}btn-delete{% else %}btn-toggle{% endif %}" 
                                       title="{% if post.is_active %}Nofaol qilish{% else %}Faollashtirish{% endif %}"
                                       onclick="return confirm('Post holatini o\'zgartirmoqchimisiz?')">
                                        {% if post.is_active %}âŒ{% else %}âœ…{% endif %}
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="{% if query_string %}?{{ query_string }}&page=1{% else %}?page=1{% endif %}" class="page-link">&laquo;</a>
                    <a href="{% if query_string %}?{{ query_string }}&page={{ page_obj.previous_page_number }}{% else %}?page={{ page_obj.previous_page_number }}{% endif %}" class="page-link">â€¹</a>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if num == page_obj.number %}
                        <a href="{% if query_string %}?{{ query_string }}&page={{ num }}{% else %}?page={{ num }}{% endif %}" class="page-link active">{{ num }}</a>
                    {% elif num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
                        <a href="{% if query_string %}?{{ query_string }}&page={{ num }}{% else %}?page={{ num }}{% endif %}" class="page-link">{{ num }}</a>
                    {% elif num == 1 or num == page_obj.paginator.num_pages %}
                        <a href="{% if query_string %}?{{ query_string }}&page={{ num }}{% else %}?page={{ num }}{% endif %}" class="page-link">{{ num }}</a>
                    {% elif num == page_obj.number|add:-3 or num == page_obj.number|add:3 %}
                        <span class="dots">...</span>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <a href="{% if query_string %}?{{ query_string }}&page={{ page_obj.next_page_number }}{% else %}?page={{ page_obj.next_page_number }}{% endif %}" class="page-link">â€º</a>
                    <a href="{% if query_string %}?{{ query_string }}&page={{ page_obj.paginator.num_pages }}{% else %}?page={{ page_obj.paginator.num_pages }}{% endif %}" class="page-link">&raquo;</a>
                {% endif %}
            </div>
        {% else %}
            <div class="empty-message">
                <h2>ğŸ“ Postlar topilmadi</h2>
                <p>Qidiruv natijasiga mos postlar topilmadi</p>
            </div>
        {% endif %}
    </div>
</div>
</body>
</html>
