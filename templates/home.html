{% load static %}
<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>devSphere - Dasturchilar Blog Platformasi</title>
<link rel="stylesheet" href="{% static 'css/base.css' %}">
<link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>
<body>

<header>
    <h1><a href="{% url 'home' %}">ğŸš€ devSphere</a></h1>
    <form method="get">
        <input name="q" type="search" placeholder="ğŸ” Qidirish..." />
    </form>
    
    <div class="profile-dropdown">
        <div class="profile-icon">ğŸ‘¤</div>
        <div class="dropdown-content">
            {% if request.user.is_authenticated %}
                {% if request.user.email %}
                    <a href="{% url 'profile' %}">ğŸ‘¤ {{ request.user.email }}</a>
                {% else %}
                    <a href="{% url 'profile' %}">ğŸ‘¤ {{ request.user.first_name }}</a>
                {% endif %}
                <a href="{% url 'post_create' %}">â• Post yozish</a>
                <a href="{% url 'my_posts' %}">ğŸ“„ Mening postlarim</a>
                {% if request.user.is_superuser %}
                    <a href="{% url 'admin_posts' %}">ğŸ”§ Admin Panel</a>
                {% endif %}
                <a href="{% url 'logout' %}">ğŸšª Chiqish</a>
            {% else %}
                <a href="{% url 'login' %}">ğŸ” Kirish</a>
                <a href="{% url 'register' %}">ğŸ“ Ro'yxatdan o'tish</a>
            {% endif %}
        </div>
    </div>
</header>

<main>
    <aside class="sidebar-left">
        <div class="section-kun-hazili">
            <h2>ğŸ’¡ Bir maqasad ostida birlashamiz!</h2>
            <div class="joke-content">
                <p>"devSphere" â€” bu dasturchilar, IT mutaxassislari va texnologiyaga
                    qiziqqanlar uchun yaratilgan blog platformasi. Maqsadimiz â€” bilim ulashish,
                    tajriba almashish va texnologik hamjamiyatni birlashtirish.</p>
            </div>
        </div>

        <div class="section-ruknlar">
            <h2>ğŸ“‚ Ruknlar</h2>
            <ul class="category-list">
                {% for i in category %}
                <li><a href="?category={{ i.slug }}" class="category">{{ i.name }}</a></li>
                {% endfor %}
            </ul>
        </div>

        <div class="section-tags">
            <h2>ğŸ·ï¸ Foydali teglar</h2>
            <ul class="tag-list">
                {% for i in tags %}
                <li><a href="?tag={{ i.name }}" class="tag">{{ i.name }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </aside>

    <section class="main-content">
        <form method="get" class="filter-bar">
            <button type="submit" name="filter" value="yangilar" class="{% if filter == 'yangilar' or not filter %}active{% endif %}">ğŸ†• Yangilar</button>
            <button type="submit" name="filter" value="yonmoqda" class="{% if filter == 'yonmoqda' %}active{% endif %}">ğŸ”¥ Yonmoqda</button>
            <button type="submit" name="filter" value="emoji" class="{% if filter == 'emoji' %}active{% endif %}">ğŸ˜Š Emoji</button>
            <button type="submit" name="filter" value="top" class="{% if filter == 'top' %}active{% endif %}">â­ TOP</button>
            <button type="submit" name="filter" value="hafta" class="{% if filter == 'hafta' %}active{% endif %}">ğŸ“… Bu haftada</button>
            <button type="submit" name="filter" value="oy" class="{% if filter == 'oy' %}active{% endif %}">ğŸ“† Bu oyda</button>
            <button type="submit" name="filter" value="hammasi" class="{% if filter == 'hammasi' %}active{% endif %}">ğŸŒ Har doim</button>
        </form>

        {% for post in post_list %}
            {% if post.is_active %}
            <article class="post-card">
                <div class="post-header">
                    <div class="category">{{ post.category }}</div>
                    <div class="views">ğŸ‘ï¸ {{ post.views }}</div>
                </div>
                <div class="post-body">
                    {% if post.image %}
                    <img src="{{ post.image.url }}" alt="Post image" class="post-image" />
                    {% endif %}
                    <div class="post-info">
                        <a href="{% url 'post' post.slug %}">
                            <h3 class="post-title">{{ post.title }}</h3>
                        </a>
                        <p class="post-desc">{{ post.content|safe|truncatewords:25 }}</p>
                    </div>
                </div>
                <div class="post-footer">
                    <div class="reactions-total">ğŸ’¬ {{ post.reactions.count }} ta reaktsiya</div>
                    <div class="emojis" data-post-id="{{ post.id }}">
                        <span onclick="react(this)" title="Like">ğŸ‘</span>
                        <span onclick="react(this)" title="Love">â¤ï¸</span>
                        <span onclick="react(this)" title="Laugh">ğŸ˜‚</span>
                        <span onclick="react(this)" title="Fire">ğŸ”¥</span>
                        <span onclick="react(this)" title="Wow">ğŸ˜®</span>
                        <span onclick="react(this)" title="Sad">ğŸ˜¢</span>
                        <span onclick="react(this)" title="Clap">ğŸ‘</span>
                    </div>
                </div>
            </article>
            {% endif %}
        {% endfor %}

        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="{% if query_string %}?{{ query_string }}&page=1{% else %}?page=1{% endif %}" class="page-link">&laquo;</a>
                <a href="{% if query_string %}?{{ query_string }}&page={{ page_obj.previous_page_number }}{% else %}?page={{ page_obj.previous_page_number }}{% endif %}" class="page-link">â€¹</a>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                    <a href="{% if query_string %}?{{ query_string }}&page={{ num }}{% else %}?page={{ num }}{% endif %}" class="page-link active">{{ num }}</a>
                {% elif num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
                    <a href="{% if query_string %}?{{ query_string }}&page={{ num }}{% else %}?page={{ num }}{% endif %}" class="page-link">{{ num }}</a>
                {% elif num == 1 or num == page_obj.paginator.num_pages %}
                    <a href="{% if query_string %}?{{ query_string }}&page={{ num }}{% else %}?page={{ num }}{% endif %}" class="page-link">{{ num }}</a>
                {% elif num == page_obj.number|add:-3 or num == page_obj.number|add:3 %}
                    <span class="dots">...</span>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <a href="{% if query_string %}?{{ query_string }}&page={{ page_obj.next_page_number }}{% else %}?page={{ page_obj.next_page_number }}{% endif %}" class="page-link">â€º</a>
                <a href="{% if query_string %}?{{ query_string }}&page={{ page_obj.paginator.num_pages }}{% else %}?page={{ page_obj.paginator.num_pages }}{% endif %}" class="page-link">&raquo;</a>
            {% endif %}
        </div>
    </section>
</main>

<div data-react-url="{% url 'react_to_post' post_id=0 %}" style="display: none;"></div>
<script src="{% static 'js/base.js' %}"></script>
<script src="{% static 'js/home.js' %}"></script>
</body>
</html>
